function [qet_dot,qt] = madgwick(qt_1, h, A, M, Swt, beta,dt)
    fg = zeros(3,1);
    Jg = zeros(3,4);
    fb = zeros(3,1);
    Jb = zeros(3,4);
    Eb = zeros(1,4);
    Eb(1,2) = h(1,1);
    Eb(1,4) = h(3,1);
    qwt_dot = 0.5*Quat_Mult(qt_1,Swt);
%     qwt_dot(1,1) = 0;
    fb(1,1) = 2*Eb(1,2)*(0.5-qt_1(1,3)^2 - qt_1(1,4)^2)+2*Eb(1,4)*(qt_1(1,2)*qt_1(1,4)-qt_1(1,1)*qt_1(1,3))-M(1,1);
    fb(2,1) = 2*Eb(1,2)*(qt_1(1,2)*qt_1(1,3)-qt_1(1,1)*qt_1(1,4))+2*Eb(1,4)*(qt_1(1,1)*qt_1(1,2)-qt_1(1,3)*qt_1(1,4))-M(2,1);
    fb(3,1) = 2*Eb(1,2)*(qt_1(1,1)*qt_1(1,3)-qt_1(1,2)*qt_1(1,4))+2*Eb(1,4)*(0.5-qt_1(1,2)^2 - qt_1(1,3)^2)- M(3,1);
    fg(1,1) = 2*(qt_1(1,2)*qt_1(1,4)-qt_1(1,1)*qt_1(1,3)-A(1,1));
    fg(2,1) = 2*(qt_1(1,1)*qt_1(1,2)-qt_1(1,3)*qt_1(1,4)-A(2,1));
    fg(1,1) = 2*(qt_1(1,2)*qt_1(1,4)-qt_1(1,1)*qt_1(1,3)-A(3,1));
    Jg(1,1) = -2*qt_1(1,3);
    Jg(1,2) = 2*qt_1(1,4);
    Jg(1,3) = -2*qt_1(1,1);
    Jg(1,4) = 2*qt_1(1,2);
    Jg(2,1) = 2*qt_1(1,2);
    Jg(2,2) = 2*qt_1(1,1);
    Jg(2,3) = 2*qt_1(1,4);
    Jg(2,4) = 2*qt_1(1,3);
    Jg(3,1) = 0;
    Jg(3,2) = -4*qt_1(1,2);
    Jg(3,3) = -4*qt_1(1,3);
    Jg(3,4) = 0;
    Jb(1,1) = -2*Eb(1,4)*qt_1(1,3);
    Jb(1,2) = 2*Eb(1,4)*qt_1(1,4);
    Jb(1,3) = -4*Eb(1,2)*qt_1(1,3) - 2*Eb(1,4)*qt_1(1,1);
    Jb(1,4) = -4*Eb(1,2)*qt_1(1,4) + 2*Eb(1,4)*qt_1(1,2);
    Jb(2,1) = -2*Eb(1,2)*qt_1(1,4) + 2*Eb(1,4)*qt_1(1,2);
    Jb(2,2) = 2*Eb(1,2)*qt_1(1,3) + 2*Eb(1,4)*qt_1(1,1);
    Jb(2,3) = 2*Eb(1,2)*qt_1(1,2) + 2*Eb(1,4)*qt_1(1,4);
    Jb(2,4) = -2*Eb(1,2)*qt_1(1,1) + 2*Eb(1,4)*qt_1(1,3);
    Jb(3,1) = 2*Eb(1,2)*qt_1(1,3);
    Jb(3,2) = 2*Eb(1,2)*qt_1(1,4) + 4*Eb(1,4)*qt_1(1,2);
    Jb(3,3) = 2*Eb(1,2)*qt_1(1,1) - 4*Eb(1,4)*qt_1(1,3);
    Jb(3,4) = 2*Eb(1,2)*qt_1(1,2);
    fgb = [fg; fb];
    Jgb = [Jg; Jb];
    qt = qt_1' + (qwt_dot - beta*((Jgb'*fgb)/norm(Jgb'*fgb)))*dt;
    qet_dot = ((Jgb'*fgb)/norm(Jgb'*fgb));
end